---
title: "Axios Interceptor"
category: Dev
tag: ['JavaScript']
date: 2023-05-22
author: 꾸생
---

클라이언트는 서버가 제공한 API를 호출해 데이터를 가져오고 브라우저에 렌더링해 사용자에게 보여준다. 이 때 서버는 RESTful 한 형태로 데이터를 제공하고 클라이언트는 해당 API에 맞는 요청을 보내 필요한 정보를 가져온다.

과거 jQuery 시절 주로 Ajax를 사용해 API를 호출했지만, 현재 프런트엔드 에서는 `Axios`나 Node에 내장된 `Fetch`를 많이 사용한다.

이번 글에서는 Axios Interceptor를 설정하는 방법을 알아보고 API 호출부터 응답까지의 과정에서 반복적은 코드를 간소화하는 방법을 작성해 본다.

## 🚥 REST API Flows
1. [Client] - 이벤트 발생
2. [Client] - API 요청
3. [Server] - 요청 받은 후 클라이언트에게 데이터 전달
4. [Client] - 응답 로직
5. [Client] - 데이터 렌더링

위 순서는 클라이언트 기준 백엔드로 API를 호출하는 간략한 로직이다. 특정 이벤트가 발생해 API 요청을 보내고 서버는 해당 요청을 받아 알맞은 데이터를 클라이언트에게 보내고 클라이언트는 데이터를 받아 화면에 뿌려준다.

API 요청은 네트워크 통신을 통해 이루어지기 때문에 여러 변수에 영향을 받는다. 클라이언트가 사용하는 디바이스나 네트워크 환경, 서버의 상태 등 다양한 요소가 통신 여부에 영향을 미치기 때문에 클라이언트는 예외 처리와 오류 대응이 중요하다. 그렇기 때문에 **Axios Interceptor**를 통해 쉽게 예외 처리를 해보자.

## Axios 인스턴스 생성

```jsx
import axios from 'axios'

const api = axios.create({
	baseURL: '/',
	timeout : 300000, // ms
	  headers: {
    'Content-Type': 'application/json',
    Accept: 'application/json',
  },
};
```

- **baseURL**: API 요청 시 사용할 기본 경로로, API요청 시 반복 입력하지 않도록 설정한다.
- **timeout**: 요청 후 대기시간으로 해당 시간 동안 응답이 없으면 요청을 자동으로 취소한다.
- **headers**: 모든 요청에 공통으로 포함될 헤더
  - **Content-type**: 서버에 전송하는 데이터 형식
  - **Accept**: 서버로 부터 받을 데이터 형식을 지정


## Interceptors

`Axios`의 `Interceptors`를 사용하면 API 요청 전과 응답 후 공통적으로 처리해야 할 로직을 하나의 위치에서 처리할 수 있어 중복 코드를 줄이고 유지보수를 쉽게 할 수 있다.

### Request Interceptor

```jsx
api.interceptors.request.use(
  (config) => {
    // 요청 보내기 전 공통 작업: 토큰을 헤더에 추가
    const token = localStorage.getItem('access_token');
    if (token) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error) => {
    // 요청 오류 처리
    console.error('Request Error:', error);
    return Promise.reject(error);
  }
);
```

API 요청을 보내기 전 실행되는데, JWT 토큰을 헤더에 자동으로 추가하거나 응답받기 전까지 사용자에게 보여줄 로딩 스피너를 호출하는 등 공통 로직을 작성한다.

### Response Interceptor

```jsx
api.interceptors.response.use(
  (response) => response.data, // 데이터 가공
	(error) => {
    // 응답 오류 처리 (예: 인증 만료 시 로그인 페이지로 이동)
    if (error.response && error.response.status === 401) {
      alert('인증이 만료되었습니다. 다시 로그인해주세요.');
      window.location.href = '/login';
    }
    console.error('Response Error:', error);
    return Promise.reject(error);
  }
);
```

API 응답을 받은 후 공통 작업을 처리한다. 서버에서 데이터를 정상적으로 받거나 에러가 발생했을 때 각각의 경우를 하나의 인터셉터에서 관리한다.
